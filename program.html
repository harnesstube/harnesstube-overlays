<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
</head>

<body style="margin:0;background:transparent;font-family:'Montserrat', Arial, sans-serif;">

<div id="program" style="
position:absolute;
top:40px;
left:40px;
width:1100px;
min-height:650px;
background:rgba(40,40,40,0.92);
color:white;
border-radius:12px;
box-shadow:0 8px 20px rgba(0,0,0,0.7);
overflow:hidden;
">

<!-- HEADER ROW 1 -->
<div style="
display:grid;
grid-template-columns: 1fr 2fr 1fr;
background:#00AF50;
padding:14px 20px;
align-items:center;
">
  <div id="h2" style="font-size:28px;font-weight:700;text-align:left;"></div>
  <div id="h1" style="font-size:32px;font-weight:700;text-align:center;"></div>
  <div id="h3" style="font-size:22px;text-align:right;"></div>
</div>

<!-- HEADER ROW 2 -->
<div style="
display:grid;
grid-template-columns: 1fr 2fr 1fr;
padding:8px 20px;
background:#2b2b2b;
font-size:20px;
align-items:center;
">
  <div id="h5" style="text-align:left;"></div>
  <div id="h4" style="text-align:center;"></div>
  <div id="h6" style="text-align:right;font-weight:700;"></div>
</div>

<!-- COLUMN HEADINGS -->
<div style="
display:flex;
padding:10px 20px 0 20px;
font-weight:700;
opacity:0.8;
">
  <div style="width:40px;"></div>
  <div style="flex:1;text-align:left;">Horse</div>
  <div style="width:180px;text-align:center;">Driver</div>
  <div style="width:180px;text-align:center;">Trainer</div>
  <div style="width:90px;text-align:right;">Finish</div>
</div>

<!-- HORSES -->
<div id="horses" style="padding:6px 20px;"></div>

<!-- BOTTOM AREA (LEFT HALF) -->
<div style="
position:absolute;
left:20px;
bottom:20px;
">

  <!-- BOTTOM TABLE (COMPACT) -->
  <table style="
width:520px;
border-collapse:collapse;
text-align:center;
font-size:18px;
">
    <tr style="
font-weight:700;
border-bottom:3px solid #00AF50;
color:#00AF50;
">
      <td style="text-align:left;width:45%;">Selections</td>
      <td style="width:13%;">1st</td>
      <td style="width:13%;">2nd</td>
      <td style="width:13%;">3rd</td>
      <td style="width:16%;">Points</td>
    </tr>
    <tbody id="grid"></tbody>
  </table>
</div>

<!-- LOGO (FREE FLOATING) -->
<img src="photos/illini_classic_sales.png" style="
position:absolute;
right:-60px;
bottom:-80px;
height:340px;
object-fit:contain;
">

</div>

<script>
window.onload = function(){

fetch("program.txt?ts="+Date.now())
.then(r=>r.text())
.then(t=>{
let l=t.split(/\r?\n/);
let i=0;

// HEADER
let location = l[i++] || "";
let raceNum  = l[i++] || "";
let date     = l[i++] || "";
let condition= l[i++] || "";
let gait     = l[i++] || "";
let purseRaw = l[i++] || "";
i++;

document.getElementById("h1").innerText = location;
document.getElementById("h2").innerText = "RACE " + raceNum;
document.getElementById("h3").innerText = date;
document.getElementById("h4").innerText = condition;
document.getElementById("h5").innerText = gait;

// Currency formatting
if(purseRaw && purseRaw !== "0"){
  let num = parseInt(purseRaw.toString().replace(/[^0-9]/g,""));
  document.getElementById("h6").innerText = "$" + num.toLocaleString();
} else {
  document.getElementById("h6").innerText = "";
}

// HORSES
let colors=["#d32f2f","#1976d2","#ffffff","#388e3c","#000000","#fbc02d","#e91e63"];
let horses=document.getElementById("horses");

for(let p=1;p<=7;p++){
let name=l[i++] || "";
let drv =l[i++] || "";
let tr  =l[i++] || "";
let fin =l[i++] || "";

if(name==="" && drv==="" && tr==="" && fin==="") continue;

let row=document.createElement("div");
row.style.display="flex";
row.style.alignItems="center";
row.style.marginBottom="6px";

row.innerHTML=`
<div style="
width:40px;
height:40px;
background:${colors[p-1]};
color:${p==3?"black":"white"};
display:flex;
align-items:center;
justify-content:center;
font-weight:700;
font-size:22px;
border-radius:6px;
margin-right:10px;
">${p}</div>

<div style="flex:1;font-size:24px;font-weight:700;text-align:left;">
${name}
</div>

<div style="width:180px;text-align:center;white-space:nowrap;">
${drv}
</div>

<div style="width:180px;text-align:center;white-space:nowrap;">
${tr}
</div>

<div style="width:90px;text-align:right;font-size:22px;font-weight:700;">
${fin}
</div>
`;
horses.appendChild(row);
}

// GRID
let grid=document.getElementById("grid");
for(let r=0;r<5;r++){
let rowLabel=l[i++] || "";
let c1=l[i++] || "";
let c2=l[i++] || "";
let c3=l[i++] || "";
let pts=l[i++] || "";

if(rowLabel==="" && c1==="" && c2==="" && c3==="" && pts==="") continue;

let tr=document.createElement("tr");
tr.innerHTML=`
<td style="text-align:left;font-weight:600;">${rowLabel}</td>
<td>${c1}</td>
<td>${c2}</td>
<td>${c3}</td>
<td>${pts}</td>
`;
grid.appendChild(tr);
}

});
}
</script>

</body>
</html>
